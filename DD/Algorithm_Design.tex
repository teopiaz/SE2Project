\section{ALGORITHM DESIGN}
\subsection{Find cars near the user}
Both Users and Cars's positions are identified in the system by GPS coordinates (Latitude and Longitude).


\noindent When a User $u$ ask for a list of cars the application send to the server his GPS position \begin{equation}
\vec{u_p} =\begin{bmatrix}user\_latitude \\ user\_longitude\end{bmatrix}
\end{equation}
\\
\noindent The shortest distance (the geodesic) between two given points $P1=(lat1, lon1)$ and $P2=(lat2, lon2)$ on the surface of a sphere with radius R is the great circle distance. 
\\\\
It can be calculated using the following formula:\\
\begin{equation}
D = arccos\Big(
\sin(lat1) * sin(lat2) + cos(lat1) * cos(lat2) * cos(lon1 - lon2)
\Big)* R
\end{equation}
\\
\noindent The first step is to convert latitude and longitude in radians\\
\begin{equation}
lat_{radians} = lat_{degree} * \pi / 180
\end{equation}
\\
In order to utilize indices on Lat and Lon we can use a method like the bounding rectangle method in Cartesian space.\\
\noindent We need to define $r$ as the angular radius of a circle in which our cars coordinate will be using $R$ as the Earth radius (6371 km) and $d$ as the maximum distance selected by the user.
\begin{equation}
	 r = d/R  
\end{equation}
for example $$ (5 km)/(6371 km) = 0.000784806$$
\\
\noindent Now we need to compute the Minimum and the Maximum Latitude and Longitude
\begin{eqnarray}
&lat_{min} = lat - r  \\
&lat_{max} = lat + r  \\
&\Delta lon = arcsin(sin(r)/cos(lat))\\
&lat_T = arcsin(sin(lat)/cos(r))\\
&lon_{min} = lonT1 = lon - \Delta lon  \\
&lon_{max} = lonT2 = lon + \Delta lon 
\end{eqnarray}
\\
\noindent After that we have computed the bounding coordinates we can use them to query a DB.\\
\begin{lstlisting}[language=SQL]
SELECT * FROM Places WHERE
(Lat => $lat_min AND Lat <= $lat_max) AND (Lon >= $lon_min AND Lon <= $lon_max )
HAVING
acos(sin( $user_lat) * sin(Lat) + cos($user_lat) * cos(Lat) * cos(Lon - ($user_lon))) <= r;
\end{lstlisting}